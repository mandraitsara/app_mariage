"use strict";(self.webpackChunklegalife=self.webpackChunklegalife||[]).push([[6432,3609],{63609:(D,S,d)=>{d.d(S,{e8:()=>o,n6:()=>i,un:()=>n});var h=d(18699),A=d.n(h),_=d(10013),b=d(81490),m=d(99836),E=d(96486),p=d.n(E),t=(l,u,a)=>new Promise((c,r)=>{var f=g=>{try{v(a.next(g))}catch(P){r(P)}},y=g=>{try{v(a.throw(g))}catch(P){r(P)}},v=g=>g.done?c(g.value):Promise.resolve(g.value).then(f,y);v((a=a.apply(l,u)).next())});let s,e;function i(l,u,a="FR"){return t(this,null,function*(){s||(s=d.e(1553).then(d.t.bind(d,1553,23))),yield s;let c;if(u==="USE_HIDDEN_ELEMENT"){c=document.createElement("input");const f=l.name;l.removeAttribute("name"),c.name=f,c.setAttribute("type","hidden")}const r=A()(l,{initialCountry:a,geoIpLookup:function(f){return t(this,null,function*(){var y;try{e||(e=$.ajax({url:"https://ipinfo.io",timeout:2e3,dataType:"jsonp"}));const v=((y=yield e)==null?void 0:y.country)||"FR";f(v)}catch(v){(0,b.c1)("error in ip lookup",v),f("FR")}})},preferredCountries:["fr","gb","es"],separateDialCode:!0,utilsScript:"fake-url",autoPlaceholder:"polite"});return u==="USE_HIDDEN_ELEMENT"&&(c.value=r.isValidNumber()?r.getNumber():null,l.insertAdjacentElement("beforebegin",c),r.telInput.form&&(r.telInput.form.addEventListener("input",function(f){r.isValidNumber()||console.warn("tel validation error",r.getNumber(),Object.keys(intlTelInputUtils.validationError)[r.getValidationError()],r.getValidationError()),c.value=r.isValidNumber()?r.getNumber():null}),r.telInput.form.addEventListener("countrychange",function(f){c.value=r.isValidNumber()?r.getNumber():null}))),r})}function o(l,u){const r=(JSON.parse(l)||[]).filter(f=>f[u]!=null).map(f=>{const y=f[u];return n(y,f.country_code)});return p().uniq(r)}function n(l,u=null){let a=(0,m._)(l);if(!a){const c=u?.split("_")[1];a=(0,m._)(l,{defaultCountry:c})}return a?a.formatInternational():l}},9410:(D,S,d)=>{d.d(S,{a:()=>t});var h=d(17942),A=d(47084),_=d.n(A),b=d(82985),m=d.n(b),E=d(93908),p=(s,e,i)=>new Promise((o,n)=>{var l=c=>{try{a(i.next(c))}catch(r){n(r)}},u=c=>{try{a(i.throw(c))}catch(r){n(r)}},a=c=>c.done?o(c.value):Promise.resolve(c.value).then(l,u);a((i=i.apply(s,e)).next())});class t{constructor(e,i={}){this.options=i,this.idPrefix="qr"+(""+Math.random()).substring(6)+"-",this.nunjucks=new(m()).Environment,this.sectionsElement=this.options.sectionsElement||$("<div>").appendTo(e),this.sectionsElement.click(o=>{const n=$(o.target),u=(n.is("a")?n:n.find("a")).attr("data-target");u&&this.callbacks&&this.callbacks.sectionSelection(u)}),this.sectionElement=$("<div>").appendTo(e),this.questionsElement=$("<div>").appendTo(e),this.nunjucks.addFilter("autoNbsp",o=>o.replace(/ (?=[?:])/g,"\xA0"))}setCallbacks(e){this.callbacks=e}setSections(e){const i=(0,h.u)(`
		<ul class="clearfix ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all qr-sections">
		{% for section in sections %}
			<li class="ui-state-default ui-corner-top
			{% if section.selected %}ui-tabs-selected{% endif %}
			{% if section.fullyAnswered %}fully-answered{% endif %}
			{{  section.def.style }}
			">
			<a class="btn btn--tabs-vertical" href="javascript:void(0)" data-target="{{section.id}}">
			{{section.def.section|autoNbsp}}
			{% if section.fullyAnswered %}
				<span>\u2713</span>
			{% else %}
				<span class="icon-arrow-tab"></span>
			{% endif %}
			</a>
			</li>
		{% endfor %}
		</ul>
		<div {% if recapSelected %}class="ui-tabs-selected"{% endif %}>
		<a class="btn btn--tabs-vertical save" data-cy="questionnaire_end">`+E.ZP.t("documents.questionnaire_end")+`<span class="icon-arrow-tab"></span></a>
		</div>
		`);this.sectionsElement.html(this.nunjucks.renderString(i,e))}clear(e){this.sectionElement.empty(),this.questionsElement.empty();const i=(0,h.u)(`
		<div class="header-qr clearfix">
		<h2 class="qr-title">
		{{def.section|autoNbsp}}
		{% if help %}
		<i class="fa fa-color fa-question-circle help-icon" title="Aide sur cette question" onclick="boxAideAttr($(this).next('.help-content').html())"></i>
		<span class="help-content display-none">{{help|safe}}</span>
		{% endif %}
		</h2>
		{% if def.subtitle %}
		<p class="qr-baseline">{{def.subtitle}}</p>
		{% endif %}
		</div>
		`),o=e.def.help?_()(e.def.help):null;this.sectionElement.html(this.nunjucks.renderString(i,{def:e.def,help:o}))}getDomId(e){return this.idPrefix+e.replace(/[^a-zA-Z0-9]/gi,"")}drawQuestion(e,i,o){const n=o?this.questionsElement.find("#"+this.getDomId(o)):null,l=this.getDomId(e.id),u=e.def.help?_()(e.def.help):null,a=u?` <i class="fa fa-color fa-question-circle help-icon" title="Aide sur cette question" onclick="boxAideAttr($(this).next('.help-content').html());return false"></i><span class="help-content display-none">`+u+"</span>":"",c='<div id="{{id}}" class="question-block"></div>',r=$(this.nunjucks.renderString(c,{id:l,question:e.def,help:u}));if(n?r.insertAfter(n):r.prependTo(this.questionsElement),e.type.render(r,{def:e.def,value:i,helpButton:a,required:!!(this.options.enforceRequired&&!e.optional)}),e.type.getValue){let f=0,y="qldfkjsklfjsljqsfkljqsdfkkldfjqs";r.change(()=>p(this,null,function*(){if(clearTimeout(f),!e.type.getValue)throw new Error("getValue should be defined");const v=yield e.type.getValue(r);v!=y&&(this.callbacks&&this.callbacks.valueChange(e.id,v),y=v)})).click(()=>{e.def.hasOwnProperty("multi_select")&&(clearTimeout(f),f=window.setTimeout(()=>{r.trigger("change")},400))}).keydown(()=>{clearTimeout(f),f=window.setTimeout(()=>{r.trigger("change")},400)})}}removeQuestion(e){this.questionsElement.find("#"+this.getDomId(e)).remove()}}},86473:(D,S,d)=>{d.d(S,{J:()=>E,f:()=>m});var h=d(31528),A=d.n(h),_=d(81490),b=(p=>(p[p.Yes=0]="Yes",p[p.AllOptional=1]="AllOptional",p[p.No=2]="No",p))(b||{}),m=(p=>(p[p.NoForce=0]="NoForce",p[p.Recap=1]="Recap",p))(m||{});class E{constructor(t,s,e={}){this.view=t,this.defFactory=s,this.options=e,this.listeners=[],this.sectionChangeListeners=[],this.forceSelection=0,t.setCallbacks(this),this.setData(e.data||{});const i=this.chooseInitialSection();this.sectionSelection(i)}getData(){return this.data}forceRefresh(t=null){do this.def=this.defFactory(this.data);while(this.applyDefaults());if(!this.currentSection)return;const s=this.currentSection.questions,e=this.def.sections.getById(this.currentSection.id);if(!e){console.warn(`la section ${this.currentSection.id} a disparu. Retour \xE0 la premi\xE8re section`),this.sectionSelection(this.def.sections.get(0).id);return}const i=e.questions,o={};for(var n=0;n<s.size();n++){const u=s.get(n),a=u.id,c=i.getById(a);let r;if(!c||!E.questionsEqual(u,c))r=!0;else if(!t)r=!1;else{const f=h.get(t,u.property),y=h.get(this.data,u.property);r=f!=y}(u.type.labelProperty=="box"||u.type.labelProperty=="osm_select")&&(r=!1),r?this.view.removeQuestion(a):o[a]=!0}for(var n=0;n<i.size();n++){const a=i.get(n);if(o[a.id])continue;var l;do l=n===0?null:i.get(n-1).id;while(l!=null&&!o[l]);const c=h.get(this.data,a.property);this.view.drawQuestion(a,c,l),o[a.id]=!0}this.currentSection=e,this.setViewSections()}setData(t){const s=JSON.parse(JSON.stringify(this.data?this.data:{}));this.data=t,this.forceRefresh(s),this.listeners.forEach(e=>e(null))}demo(){const t=JSON.parse(JSON.stringify(this.data));do this.def=this.defFactory(this.data);while(this.batchChanges(s=>s.type.readOnly?null:s.demo));this.forceRefresh(t)}listen(t){this.listeners.push(t)}listenSectionChange(t){this.sectionChangeListeners.push(t)}valueChange(t,s){const e=this.currentSection.questions.getById(t);if(!e){(0,_.c1)("question has disappeared",{questionId:t});return}if(e.readonly)return;typeof s=="string"&&(s=s.trim());const i={property:e.property,value:s};this.valueChangeImpl(i);const o=JSON.parse(JSON.stringify(this.data));this.forceRefresh(o),this.listeners.forEach(n=>n(i))}valueChangeImpl(t){if(t.property!==void 0)if(t.value===void 0)h.del(this.data,t.property);else{const s=t.property.split(".");for(let e=0;e<s.length-1;e++){const i=s.slice(0,e+1).join(".");h.get(this.data,i)||(Number.isInteger(Number(s[e+1]))?h.set(this.data,i,[]):h.set(this.data,i,{}))}h.set(this.data,t.property,t.value)}}getProgression(){return[this.def.sections.getIndex(this.currentSection.id),this.def.sections.size()]}nextSection(){return this.incrementSection(1)}prevSection(){return this.incrementSection(-1)}setForceSelection(t){this.forceSelection=t,this.setViewSections()}incrementSection(t){const s=this.def.sections.getIndex(this.currentSection.id)+t;if(s<0||s>=this.def.sections.size())throw new Error("index out of bound: "+s);return this.sectionSelection(this.def.sections.get(s).id)}isCurrentSectionFullyAnswered(){return this.isSectionFullyAnswered(this.currentSection)!=2}isFullyAnswered(){return this.def.sections.asArray().every(t=>this.isSectionFullyAnswered(t)!=2)}isSectionFullyAnswered(t){const s=t.questions.asArray();return s.every(e=>e.readonly||e.type.readOnly||e.optional||e.default&&h.get(this.data,e.property)==e.default)?1:s.every(i=>i.readonly||i.type.readOnly||i.optional?!0:this.validateAnswer(i))?0:2}chooseInitialSection(){const t=this.def.sections.asArray().filter(e=>this.isSectionFullyAnswered(e)===2);let s;if(t.length===0)s=0;else for(s=this.def.sections.getIndex(t[0].id);s>0;){const e=this.def.sections.get(s-1);if(this.isSectionFullyAnswered(e)===0)break;s--}return this.def.sections.get(s).id}setViewSections(){let t=!0;const s=this.def.sections.asArray().map(e=>{const i=this.forceSelection==0&&this.currentSection.id===e.id,o=this.isSectionFullyAnswered(e),n=o==0||o==1&&t&&!i;return t=n,{id:e.id,def:e.def,selected:i,fullyAnswered:n}});this.view.setSections({recapSelected:this.forceSelection==1,sections:s})}sectionSelection(t){const s=this.def.sections.getById(t);if(!s)return(0,_.c1)("section has disappeared",{sectionId:t}),!0;let e;if(!this.options.enforceRequired||!this.currentSection)e=!1;else{const i=this.def.sections.getIndex(t),n=this.def.sections.asArray().slice(0,i).filter(l=>this.isSectionFullyAnswered(l)==2);e=n.length>0,e&&this.sectionSelection(n[0].id)}if(e)return this.options.onForbiddenMove&&this.options.onForbiddenMove(),!1;this.currentSection=s,this.setViewSections(),this.view.clear(this.currentSection);for(let i=0;i<this.currentSection.questions.size();i++){const o=this.currentSection.questions.get(i),n=i===0?null:this.currentSection.questions.get(i-1).id,l=h.get(this.data,o.property);this.view.drawQuestion(o,l,n)}return this.sectionChangeListeners.forEach(i=>i()),!0}static questionsEqual(t,s){return JSON.stringify(t)==JSON.stringify(s)}applyDefaults(){const t=this.applyStaticData(null,this.def.staticData),s=this.batchChanges(e=>e.default===void 0||h.has(this.data,e.property)&&h.get(this.data,e.property)!==null?null:e.default);return t||s}applyStaticData(t,s){let e=!1;for(const i in s){const o=s[i],n=t?t+"."+i:i;o instanceof Object?e=this.applyStaticData(n,o)||e:h.get(this.data,n)!==o&&(h.set(this.data,n,o),e=!0)}return e}batchChanges(t){const s=[];return this.def.sections.asArray().forEach(e=>{e.questions.asArray().forEach(i=>{const o=t(i);o===null||h.get(this.data,i.property)===o||s.push({property:i.property,value:o})})}),s.length==0?!1:(s.forEach(e=>this.valueChangeImpl(e)),!0)}validateAnswer(t){const s=h.get(this.data,t.property);if(["",null,void 0].indexOf(s)!==-1)return!1;if(t.type.labelProperty==="radio")return t.def.choices.some(e=>e.value==s);if(t.type.labelProperty==="checkboxes"){const e=t.def.choices.map(i=>i.value.toString());return Object.keys(s).filter(i=>e.indexOf(i.toString())>-1).length>0}return!0}}}}]);
